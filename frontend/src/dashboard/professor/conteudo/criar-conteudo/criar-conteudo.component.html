<div class="dashboard-container">
  
  <div class="cabecalho"><button class="btn btn-primary" routerLink="/dashboard-professor" >voltar</button>
  <h1 class="dashboard-title">Gerenciar Conte√∫dos</h1></div>

  <div class="dashboard-layout">
    <!-- FORMUL√ÅRIO - LADO ESQUERDO -->
    <div class="form-panel">
      <div class="panel-header">
        <h2>{{ editandoConteudo ? 'Editar Conte√∫do' : 'Criar Novo Conte√∫do' }}</h2>
      </div>
      
      <!-- Seletor de tipo de conte√∫do -->
      <div class="tipo-selector" *ngIf="!editandoConteudo">
        <button 
          type="button" 
          class="tipo-btn" 
          [class.active]="tipoConteudo === 'TEXTO'"
          (click)="setTipo('TEXTO')">
          <span class="tipo-icon">üìù</span>
          Texto
        </button>
        <button 
          type="button" 
          class="tipo-btn" 
          [class.active]="tipoConteudo === 'PDF'"
          (click)="setTipo('PDF')">
          <span class="tipo-icon">üìÑ</span>
          PDF
        </button>
        <button 
          type="button" 
          class="tipo-btn" 
          [class.active]="tipoConteudo === 'LINK'"
          (click)="setTipo('LINK')">
          <span class="tipo-icon">üîó</span>
          Link
        </button>
      </div>

      <form [formGroup]="form" (ngSubmit)="editandoConteudo ? atualizarConteudo() : criarConteudo()" class="content-form">
        
        <!-- Campo Material -->
        <div class="form-group">
          <label class="form-label">Mat√©ria</label>
          <select formControlName="materialId" class="form-input">
            <option value="">Selecione</option>
            <option *ngFor="let m of materiais" [value]="m.id">{{ m.nome || m.titulo }}</option>
          </select>
        </div>

        <!-- Campo T√≠tulo -->
        <div class="form-group">
          <label for="titulo" class="form-label">T√≠tulo *</label>
          <input 
            id="titulo" 
            type="text" 
            formControlName="titulo" 
            class="form-input"
            placeholder="Digite o t√≠tulo do conte√∫do">
        </div>

        <!-- Campo Descri√ß√£o -->
        <div class="form-group">
          <label for="descricao" class="form-label">Descri√ß√£o *</label>
          <textarea 
            id="descricao" 
            formControlName="descricao" 
            class="form-input form-textarea"
            rows="3"
            placeholder="Digite a descri√ß√£o do conte√∫do"></textarea>
        </div>

        <!-- Campo Texto (para TEXTO e LINK) -->
        <div class="form-group" *ngIf="tipoConteudo === 'TEXTO' || tipoConteudo === 'LINK'">
          <label for="texto" class="form-label">Texto do Conte√∫do</label>
          <textarea 
            id="texto" 
            formControlName="texto" 
            class="form-input form-textarea"
            rows="6"
            placeholder="Digite o conte√∫do aqui"></textarea>
        </div>

        <!-- Campo URL (apenas para LINK) -->
        <div class="form-group" *ngIf="tipoConteudo === 'LINK'">
          <label for="url" class="form-label">URL *</label>
          <input 
            id="url" 
            type="url" 
            formControlName="url" 
            class="form-input"
            placeholder="https://exemplo.com">
        </div>

        <!-- Upload de PDF -->
        <div class="form-group" *ngIf="tipoConteudo === 'PDF' && !editandoConteudo">
          <label for="pdf" class="form-label">Arquivo PDF *</label>
          <input 
            id="pdf" 
            type="file" 
            accept=".pdf"
            (change)="onFileSelected($event)"
            class="form-input file-input">
          <small class="help-text">M√°ximo 10MB</small>
          <div *ngIf="selectedPdf" class="file-info">
            <span class="file-icon"></span>
            {{ selectedPdf.name }}
          </div>
        </div>

        <!-- Bot√µes -->
        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="loading">
            {{ loading ? 'Processando...' : (editandoConteudo ? 'Atualizar' : 'Criar') }}
          </button>
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="cancelarEdicao()"
            *ngIf="editandoConteudo">
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- LISTA - LADO DIREITO -->
    <div class="list-panel">
      <div class="panel-header">
        <h2>Conte√∫dos Criados</h2>
        <div class="content-count" *ngIf="conteudo.length > 0">
          {{ conteudo.length }} item(s)
        </div>
      </div>
      
      <div class="content-scroll">
        <div *ngIf="conteudo.length === 0" class="no-content">
          <div class="empty-state">
            <span class="empty-icon">üìö</span>
            <p>Nenhum conte√∫do encontrado.</p>
          </div>
        </div>

        <div class="content-list" *ngIf="conteudo.length > 0">
          <div *ngFor="let item of conteudo" class="content-card">
            <div class="card-header">
              <div class="content-info">
                <h3 class="content-title">{{ item.titulo }}</h3>
                <span class="type-badge" [ngClass]="'type-' + item.tipo?.toLowerCase()">
                  {{ item.tipo || 'TEXTO' }}
                </span>
              </div>
            </div>
            
            <div class="card-body">
              <p class="content-description">{{ item.descricao }}</p>
              
              <div class="material-tag" *ngIf="item.material">
                <span class="tag-icon"></span>
                {{ item.material.titulo }}
              </div>
              
              <!-- Preview do conte√∫do -->
              <div class="content-preview" *ngIf="item.texto">
                {{ item.texto.substring(0, 80) }}{{ item.texto.length > 80 ? '...' : '' }}
              </div>
              
              <!-- Link preview -->
              <div class="link-preview" *ngIf="item.url">
                <a [href]="item.url" target="_blank" class="preview-link">
                  üîó {{ item.url.substring(0, 40) }}{{ item.url.length > 40 ? '...' : '' }}
                </a>
              </div>

              <!-- PDF info -->
              <div class="pdf-info" *ngIf="item.tipo === 'PDF' && item.nomeArquivo">
                <span class="file-icon"></span>
                {{ item.nomeArquivo }}
                <span *ngIf="item.tamanho" class="file-size">
                  ({{ formatarTamanhoArquivo(item.tamanho) }})
                </span>
              </div>
            </div>

            <div class="card-actions">
              <button 
                class="action-btn view-btn"
                (click)="visualizarConteudo(item)"
                title="Visualizar">
                
              </button>
              
              <button 
                class="action-btn edit-btn"
                (click)="editarConteudo(item)"
                title="Editar">
                
              </button>
              
              <button 
                class="action-btn download-btn"
                (click)="downloadPdf(item.id, item.titulo)"
                *ngIf="item.tipo === 'PDF'"
                title="Download PDF">
                
              </button>
              
              <button 
                class="action-btn delete-btn"
                (click)="confirmarDelecao(item)"
                title="Excluir">
                
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de visualiza√ß√£o -->
  <div class="modal" *ngIf="conteudoSelecionado" (click)="fecharModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ conteudoSelecionado.titulo }}</h3>
        <button class="close-btn" (click)="fecharModal()"></button>
      </div>
      <div class="modal-body">
        <div class="modal-info">
          <p><strong>Descri√ß√£o:</strong> {{ conteudoSelecionado.descricao }}</p>
          <p><strong>Material:</strong> {{ conteudoSelecionado.material?.titulo }}</p>
          <p><strong>Tipo:</strong> {{ conteudoSelecionado.tipo || 'TEXTO' }}</p>
        </div>
        <div *ngIf="conteudoSelecionado.texto" class="modal-content-text">
          <strong>Conte√∫do:</strong>
          <div class="content-text">{{ conteudoSelecionado.texto }}</div>
        </div>
        <div *ngIf="conteudoSelecionado.url" class="modal-link">
          <strong>Link:</strong>
          <a [href]="conteudoSelecionado.url" target="_blank">{{ conteudoSelecionado.url }}</a>
        </div>
        <div *ngIf="conteudoSelecionado.tipo === 'PDF' && conteudoSelecionado.nomeArquivo" class="modal-file">
          <p><strong>Arquivo:</strong> {{ conteudoSelecionado.nomeArquivo }}</p>
          <p *ngIf="conteudoSelecionado.tamanho"><strong>Tamanho:</strong> {{ formatarTamanhoArquivo(conteudoSelecionado.tamanho) }}</p>
        </div>
        <div *ngIf="conteudoSelecionado.professor" class="modal-professor">
          <p><strong>Professor:</strong> {{ conteudoSelecionado.professor.nome }}</p>
        </div>
        <p class="modal-date"><strong>Criado em:</strong> {{ conteudoSelecionado.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>
    </div>
  </div>

  <!-- Modal de confirma√ß√£o de dele√ß√£o -->
  <div class="modal" *ngIf="conteudoParaDeletar" (click)="cancelarDelecao()">
    <div class="modal-content modal-small" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirmar Exclus√£o</h3>
      </div>
      <div class="modal-body">
        <div class="delete-warning">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <div>
            <p>Tem certeza que deseja excluir o conte√∫do "<strong>{{ conteudoParaDeletar.titulo }}</strong>"?</p>
            <p class="warning-text">Esta a√ß√£o n√£o pode ser desfeita.</p>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger" (click)="deletarConteudo()">Excluir</button>
        <button class="btn btn-secondary" (click)="cancelarDelecao()">Cancelar</button>
      </div>
    </div>
  </div>
</div>