<app-navbar2></app-navbar2>
  
<div class="cabecalho">
  <button class="btn btn-primary" routerLink="/dashboard-professor">voltar</button>
  <h1 class="dashboard-title">Gerenciar Conte√∫dos</h1>
</div>

<div class="dashboard-layout">
  <div class="form-panel">
    <div class="panel-header">
      <h2>{{ editandoConteudo ? 'Editar Conte√∫do' : 'Criar Novo Conte√∫do' }}</h2>
    </div>
    
    <div class="tipo-selector" *ngIf="!editandoConteudo">
      <button 
        type="button" 
        class="tipo-btn" 
        [class.active]="tipoConteudo === 'TEXTO'"
        (click)="setTipo('TEXTO')">
        <span class="tipo-icon">üìù</span>
        Texto
      </button>
      <button 
        type="button" 
        class="tipo-btn" 
        [class.active]="tipoConteudo === 'PDF'"
        (click)="setTipo('PDF')">
        <span class="tipo-icon">üìÑ</span>
        PDF
      </button>
      <button 
        type="button" 
        class="tipo-btn" 
        [class.active]="tipoConteudo === 'LINK'"
        (click)="setTipo('LINK')">
        <span class="tipo-icon">üîó</span>
        Link
      </button>
    </div>

    <form [formGroup]="form" (ngSubmit)="editandoConteudo ? atualizarConteudo() : criarConteudo()" class="content-form">
      
      <div class="form-group">
        <label class="form-label">Mat√©ria</label>
        <select formControlName="materialId" class="form-input">
          <option value="">Selecione</option>
          <option *ngFor="let m of materiais" [value]="m.id">{{ m.nome || m.titulo }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="titulo" class="form-label">T√≠tulo *</label>
        <input 
          id="titulo" 
          type="text" 
          formControlName="titulo" 
          class="form-input"
          placeholder="Digite o t√≠tulo do conte√∫do">
      </div>

      <div class="form-group">
        <label for="descricao" class="form-label">Descri√ß√£o *</label>
        <textarea 
          id="descricao" 
          formControlName="descricao" 
          class="form-input form-textarea"
          rows="3"
          placeholder="Digite a descri√ß√£o do conte√∫do"></textarea>
      </div>

      <div class="form-group" *ngIf="tipoConteudo === 'TEXTO' || tipoConteudo === 'LINK'">
        <label for="texto" class="form-label">Texto do Conte√∫do</label>
        <textarea 
          id="texto" 
          formControlName="texto" 
          class="form-input form-textarea"
          rows="6"
          placeholder="Digite o conte√∫do aqui"></textarea>
      </div>

      <div class="form-group" *ngIf="tipoConteudo === 'LINK'">
        <label for="url" class="form-label">URL *</label>
        <input 
          id="url" 
          type="url" 
          formControlName="url" 
          class="form-input"
          placeholder="https://exemplo.com">
      </div>

      <div class="form-group" *ngIf="tipoConteudo === 'PDF' && !editandoConteudo">
        <label for="pdf" class="form-label">Arquivo PDF *</label>
        <input 
          id="pdf" 
          type="file" 
          accept=".pdf"
          (change)="onFileSelected($event)"
          class="form-input file-input">
        <small class="help-text">M√°ximo 10MB</small>
        <div *ngIf="selectedPdf" class="file-info">
          <span class="file-icon"></span>
          {{ selectedPdf.name }}
        </div>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="loading">
          {{ loading ? 'Processando...' : (editandoConteudo ? 'Atualizar' : 'Criar') }}
        </button>
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="cancelarEdicao()"
          *ngIf="editandoConteudo">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <div class="list-panel">
    <div class="panel-header">
      <h2>Conte√∫dos Criados</h2>
      <div class="content-count" *ngIf="conteudo.length > 0">
        {{ conteudo.length }} item(s)
      </div>
    </div>
    
    <div class="content-scroll">
      <div *ngIf="conteudo.length === 0" class="no-content">
        <div class="empty-state">
          <span class="empty-icon">üìö</span>
          <p>Nenhum conte√∫do encontrado.</p>
        </div>
      </div>

      <div class="content-list" *ngIf="conteudo.length > 0">
        <div *ngFor="let item of conteudo" class="content-card">
          <div class="card-header">
            <div class="content-info">
              <h3 class="content-title">{{ item.titulo }}</h3>
              <span class="type-badge" [ngClass]="'type-' + item.tipo?.toLowerCase()">
                {{ item.tipo || 'TEXTO' }}
              </span>
            </div>
          </div>
          
          <div class="card-body">
            <p class="content-description">{{ item.descricao }}</p>
            
            <div class="material-tag" *ngIf="item.material">
              <span class="tag-icon"></span>
              {{ item.material.titulo }}
            </div>
            
            <div class="content-preview" *ngIf="item.texto">
              {{ item.texto.substring(0, 80) }}{{ item.texto.length > 80 ? '...' : '' }}
            </div>
            
            <div class="link-preview" *ngIf="item.url">
              <a [href]="item.url" target="_blank" class="preview-link">
                üîó {{ item.url.substring(0, 40) }}{{ item.url.length > 40 ? '...' : '' }}
              </a>
            </div>

            <div class="pdf-info" *ngIf="item.tipo === 'PDF' && item.nomeArquivo">
              <span class="file-icon"></span>
              {{ item.nomeArquivo }}
              <span *ngIf="item.tamanho" class="file-size">
                ({{ formatarTamanhoArquivo(item.tamanho) }})
              </span>
            </div>
          </div>

          <div class="card-actions">
            <button 
              class="action-btn view-btn"
              (click)="visualizarConteudo(item)"
              title="Visualizar">
            </button>
            
            <button 
              class="action-btn edit-btn"
              (click)="editarConteudo(item)"
              title="Editar">
            </button>
            
            <button 
              class="action-btn download-btn"
              (click)="downloadPdf(item.id, item.titulo)"
              *ngIf="item.tipo === 'PDF'"
              title="Download PDF">
            </button>
            
            <button 
              class="action-btn delete-btn"
              (click)="excluirConteudo(item)" 
              title="Excluir">
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #modalAviso let-modal>
  <div class="modal-header">
    <h4 class="modal-title">{{ tituloModal }}</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <p>{{ mensagemModal }}</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="modal.close()">OK</button>
  </div>
</ng-template>

<ng-template #modalExclusao let-modal>
  <div class="modal-header">
    <h4 class="modal-title">Confirmar Exclus√£o</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <p><strong>Voc√™ tem certeza que deseja excluir este conte√∫do?</strong></p>
    <p class="text-danger">Esta a√ß√£o n√£o poder√° ser desfeita.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancelar</button>
    <button type="button" class="btn btn-danger" (click)="modal.close('confirm')">Sim, excluir</button>
  </div>
</ng-template>