<div class="container">
  <h1>Gerenciar Conte√∫dos</h1>

  <!-- Formul√°rio para criar/editar conte√∫do -->
  <div class="form-section">
    <h2>{{ editandoConteudo ? 'Editar Conte√∫do' : 'Criar Novo Conte√∫do' }}</h2>
    
    <!-- Seletor de tipo de conte√∫do -->
    <div class="tipo-selector" *ngIf="!editandoConteudo">
      <button 
        type="button" 
        class="tipo-btn" 
        [class.active]="tipoConteudo === 'TEXTO'"
        (click)="setTipo('TEXTO')">
        Texto
      </button>
      <button 
        type="button" 
        class="tipo-btn" 
        [class.active]="tipoConteudo === 'PDF'"
        (click)="setTipo('PDF')">
        PDF
      </button>
      <button 
        type="button" 
        class="tipo-btn" 
        [class.active]="tipoConteudo === 'LINK'"
        (click)="setTipo('LINK')">
        Link
      </button>
    </div>

    <form [formGroup]="form" (ngSubmit)="editandoConteudo ? atualizarConteudo() : criarConteudo()">
      
      <!-- Campo Material -->
     <div class="form-group"> <label>Mat√©ria</label> <select formControlName="materialId"> <option value="">Selecione</option> <!-- Mostrando nome da mat√©ria --> <option *ngFor="let m of materiais" [value]="m.id">{{ m.nome || m.titulo }}</option> </select> </div>

      <!-- Campo T√≠tulo -->
      <div class="form-group">
        <label for="titulo">T√≠tulo *</label>
        <input 
          id="titulo" 
          type="text" 
          formControlName="titulo" 
          class="form-control"
          placeholder="Digite o t√≠tulo do conte√∫do">
      </div>

      <!-- Campo Descri√ß√£o -->
      <div class="form-group">
        <label for="descricao">Descri√ß√£o *</label>
        <textarea 
          id="descricao" 
          formControlName="descricao" 
          class="form-control"
          rows="3"
          placeholder="Digite a descri√ß√£o do conte√∫do"></textarea>
      </div>

      <!-- Campo Texto (para TEXTO e LINK) -->
      <div class="form-group" *ngIf="tipoConteudo === 'TEXTO' || tipoConteudo === 'LINK'">
        <label for="texto">Texto do Conte√∫do</label>
        <textarea 
          id="texto" 
          formControlName="texto" 
          class="form-control"
          rows="6"
          placeholder="Digite o conte√∫do aqui"></textarea>
      </div>

      <!-- Campo URL (apenas para LINK) -->
      <div class="form-group" *ngIf="tipoConteudo === 'LINK'">
        <label for="url">URL *</label>
        <input 
          id="url" 
          type="url" 
          formControlName="url" 
          class="form-control"
          placeholder="https://exemplo.com">
      </div>

      <!-- Upload de PDF -->
      <div class="form-group" *ngIf="tipoConteudo === 'PDF' && !editandoConteudo">
        <label for="pdf">Arquivo PDF *</label>
        <input 
          id="pdf" 
          type="file" 
          accept=".pdf"
          (change)="onFileSelected($event)"
          class="form-control">
        <small class="help-text">M√°ximo 10MB</small>
        <div *ngIf="selectedPdf" class="file-info">
          Arquivo selecionado: {{ selectedPdf.name }}
        </div>
      </div>

      <!-- Bot√µes -->
      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="loading">
          {{ loading ? 'Processando...' : (editandoConteudo ? 'Atualizar' : 'Criar') }}
        </button>
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="cancelarEdicao()"
          *ngIf="editandoConteudo">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de conte√∫dos -->
  <div class="content-list">
    <h2>Conte√∫dos Criados</h2>
    
    <div *ngIf="conteudo.length === 0" class="no-content">
      Nenhum conte√∫do encontrado.
    </div>

    <div class="content-grid">
      <div *ngFor="let item of conteudo" class="content-card">
        <div class="content-header">
          <h3>{{ item.titulo }}</h3>
          <div class="content-type">
            <span class="type-badge" [ngClass]="'type-' + item.tipo?.toLowerCase()">
              {{ item.tipo || 'TEXTO' }}
            </span>
          </div>
        </div>
        
        <div class="content-body">
          <p class="description">{{ item.descricao }}</p>
          <div class="material-info" *ngIf="item.material">
            <small><strong>Material:</strong> {{ item.material.nome }}</small>
          </div>
          
          <!-- Preview do conte√∫do -->
          <div class="content-preview" *ngIf="item.texto">
            <small>{{ item.texto.substring(0, 100) }}{{ item.texto.length > 100 ? '...' : '' }}</small>
          </div>
          
          <!-- Link preview -->
          <div class="link-preview" *ngIf="item.url">
            <a [href]="item.url" target="_blank" class="external-link">
              {{ item.url }}
            </a>
          </div>

          <!-- PDF info -->
          <div class="pdf-info" *ngIf="item.tipo === 'PDF' && item.nomeArquivo">
            <small><strong>Arquivo:</strong> {{ item.nomeArquivo }}</small>
            <small *ngIf="item.tamanho" class="file-size">
              ({{ formatarTamanhoArquivo(item.tamanho) }})
            </small>
          </div>
        </div>

        <div class="content-actions">
          <button 
            class="btn btn-sm btn-info"
            (click)="visualizarConteudo(item)"
            title="Visualizar">
            üëÅÔ∏è
          </button>
          
          <button 
            class="btn btn-sm btn-warning"
            (click)="editarConteudo(item)"
            title="Editar">
            ‚úèÔ∏è
          </button>
          
          <button 
            class="btn btn-sm btn-success"
            (click)="downloadPdf(item.id, item.titulo)"
            *ngIf="item.tipo === 'PDF'"
            title="Download PDF">
            üìÑ
          </button>
          
          <button 
            class="btn btn-sm btn-danger"
            (click)="confirmarDelecao(item)"
            title="Excluir">
            üóëÔ∏è
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de visualiza√ß√£o -->
  <div class="modal" *ngIf="conteudoSelecionado" (click)="fecharModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>{{ conteudoSelecionado.titulo }}</h3>
        <button class="close-btn" (click)="fecharModal()">√ó</button>
      </div>
      <div class="modal-body">
        <p><strong>Descri√ß√£o:</strong> {{ conteudoSelecionado.descricao }}</p>
        <p><strong>Material:</strong> {{ conteudoSelecionado.material?.nome }}</p>
        <p><strong>Tipo:</strong> {{ conteudoSelecionado.tipo || 'TEXTO' }}</p>
        <div *ngIf="conteudoSelecionado.texto">
          <strong>Conte√∫do:</strong>
          <div class="content-text">{{ conteudoSelecionado.texto }}</div>
        </div>
        <div *ngIf="conteudoSelecionado.url">
          <strong>Link:</strong>
          <a [href]="conteudoSelecionado.url" target="_blank">{{ conteudoSelecionado.url }}</a>
        </div>
        <div *ngIf="conteudoSelecionado.tipo === 'PDF' && conteudoSelecionado.nomeArquivo">
          <p><strong>Arquivo:</strong> {{ conteudoSelecionado.nomeArquivo }}</p>
          <p *ngIf="conteudoSelecionado.tamanho"><strong>Tamanho:</strong> {{ formatarTamanhoArquivo(conteudoSelecionado.tamanho) }}</p>
        </div>
        <div *ngIf="conteudoSelecionado.professor">
          <p><strong>Professor:</strong> {{ conteudoSelecionado.professor.nome }}</p>
        </div>
        <p><strong>Criado em:</strong> {{ conteudoSelecionado.createdAt | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>
    </div>
  </div>

  <!-- Modal de confirma√ß√£o de dele√ß√£o -->
  <div class="modal" *ngIf="conteudoParaDeletar" (click)="cancelarDelecao()">
    <div class="modal-content modal-small" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirmar Exclus√£o</h3>
      </div>
      <div class="modal-body">
        <p>Tem certeza que deseja excluir o conte√∫do "<strong>{{ conteudoParaDeletar.titulo }}</strong>"?</p>
        <p class="warning">Esta a√ß√£o n√£o pode ser desfeita.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger" (click)="deletarConteudo()">Excluir</button>
        <button class="btn btn-secondary" (click)="cancelarDelecao()">Cancelar</button>
      </div>
    </div>
  </div>
</div>