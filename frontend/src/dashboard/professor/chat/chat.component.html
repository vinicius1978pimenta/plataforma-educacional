<app-navbar2></app-navbar2>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="chat-container">
  <!-- Modal para Nome do Usu치rio -->
  <div class="modal-overlay" *ngIf="showNameModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3><i class="fas fa-user-plus"></i> Digite seu nome</h3>
        <button class="close-btn" (click)="closeModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Digite seu nome como <strong>{{ getUserTypeLabel(selectedUserType) }}</strong>:</p>
        <input 
          type="text" 
          class="name-input" 
          [(ngModel)]="tempUserName"
          (keyup.enter)="confirmUserName()"
          placeholder="Seu nome..."
          maxlength="50"
          #nameInput>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModal()">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button class="confirm-btn" (click)="confirmUserName()" [disabled]="!tempUserName.trim()">
          <i class="fas fa-check"></i> Confirmar
        </button>
      </div>
    </div>
  </div>

  <!-- Sele칞칚o de Usu치rio -->
  <div class="user-selection" *ngIf="!currentUser">
    <div class="user-card">
      <h2><i class="fas fa-user-astronaut"></i> Bem-vindo ao Chat!</h2>
      <p>Converse com alunos e acompanhe as atividades de forma r치pida e pr치tica.</p>
      <div class="user-buttons">
        <button class="user-btn professor" (click)="openNameModal('professor')">
          <i class="fas fa-user-astronaut"></i> Professor
        </button>
      </div>
      <div class="user-helper">
        <p>游늷 Voc칡 pode:</p>
        <ul>
          <li><i class="fas fa-robot"></i> Enviar mensagens para alunos e Respons치vel!</li>
          <li><i class="fas fa-user-astronaut"></i> Responder d칰vidas em Tempo Real</li>
          <li><i class="fas fa-robot"></i> Conversar com o Respons치vel</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Interface do Chat -->
  <div class="chat-interface" *ngIf="currentUser">
    <!-- Header do Chat -->
    <div class="chat-header">
      <div class="user-info">
        <span class="user-avatar"><i class="fas fa-user-astronaut"></i></span>
        <div>
          <strong>{{ currentUser.name }}</strong>
          <small>({{ getUserTypeLabel(currentUser.type) }})</small>
        </div>
      </div>
      <div class="channel-info">
        <select class="channel-select" [(ngModel)]="selectedChannel" (change)="onChannelChange()">
          <option value="">Selecionar conversa...</option>
          <option *ngFor="let channel of getAvailableChannels()" [value]="channel.id">
            {{ channel.name }}
          </option>
        </select>
      </div>
      <button class="logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
    </div>

    <!-- 츼rea de Mensagens -->
    <div class="messages-container" #messagesContainer>
      <div class="message-info" *ngIf="!selectedChannel">
        <p><i class="fas fa-info-circle"></i> Selecione uma conversa para come칞ar</p>
      </div>
             
      <div class="message"
           *ngFor="let message of messages"
           [class.own-message]="message.senderId === currentUser.id"
           [class.other-message]="message.senderId !== currentUser.id">
        <div class="message-header">
          <span class="sender-avatar">
            <i class="fas" [ngClass]="message.senderId === currentUser.id ? 'fa-user-astronaut' : 'fa-user-circle'"></i>
          </span>
          <span class="sender-name">{{ message.senderName }}</span>
          <span class="message-time"><i class="far fa-clock"></i> {{ formatTime(message.timestamp) }}</span>
        </div>
        <div class="message-content">
          <i class="fas fa-comment-dots"></i> {{ message.content }}
        </div>
      </div>
    </div>

    <!-- Input de Mensagem -->
    <div class="message-input-container" *ngIf="selectedChannel">
      <div class="input-wrapper">
        <input 
          type="text"
          class="message-input"
          [(ngModel)]="newMessage"
          (keyup.enter)="sendMessage()"
          placeholder="Digite sua mensagem..."
          maxlength="500">
        <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessage.trim()">
          <i class="fas fa-paper-plane"></i> Enviar
        </button>
      </div>
    </div>
  </div>
</div>