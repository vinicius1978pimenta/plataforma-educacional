<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<app-navbar2></app-navbar2>

<div class="chat-container">

  <!-- Sele√ß√£o de Usu√°rio -->
  <div class="user-selection" *ngIf="!currentUser">
    <div class="user-card">
      <h2><i class="fas fa-handshake"></i> Bem-vindo(a) ao Chat!</h2>
      <p>Converse diretamente com o professor respons√°vel pelo seu filho(a).</p>
      <div class="user-buttons">
        <button 
          class="user-btn responsavel" 
          (click)="selectUser('responsavel')"
        >
          <i class="fas fa-user-friends"></i> Entrar como Respons√°vel
        </button>
      </div>
      <div class="welcome-emoji">
        <i class="fas fa-smile-beam fa-2x"></i>
      </div>
    </div>
  </div>

  <!-- Interface do Chat -->
  <div class="chat-interface" *ngIf="currentUser">
    
    <!-- Header do Chat -->
    <div class="chat-header">
      <div class="user-info">
        <!-- Avatar com √≠cone direto -->
        <span class="user-avatar">
          <i *ngIf="currentUser.type === 'responsavel'" class="fas fa-user-friends"></i>
          <i *ngIf="currentUser.type === 'professor'" class="fas fa-chalkboard-teacher"></i>
          <i *ngIf="currentUser.type !== 'responsavel' && currentUser.type !== 'professor'" class="fas fa-user"></i>
        </span>
        <div>
          <strong>{{ currentUser.name }}</strong>
          <small>({{ getUserTypeLabel(currentUser.type) }})</small>
        </div>
      </div>

      <div class="channel-info">
        <select class="channel-select" [(ngModel)]="selectedChannel" (change)="onChannelChange()">
          <option value=""><i class="fas fa-comments"></i> Selecionar conversa...</option>
          <option 
            *ngFor="let channel of getAvailableChannels()" 
            [value]="channel.id"
          >
            <i class="fas fa-user"></i> {{ channel.name }}
          </option>
        </select>
      </div>

      <button class="logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
    </div>

    <!-- √Årea de Mensagens -->
    <div class="messages-container" #messagesContainer>
      <div class="message-info" *ngIf="!selectedChannel">
        <i class="fas fa-envelope-open-text fa-2x"></i>
        <p>Selecione uma conversa para come√ßar üì©</p>
      </div>
      
      <div class="message" 
           *ngFor="let message of messages" 
           [class.own-message]="message.senderId === currentUser.id"
           [class.other-message]="message.senderId !== currentUser.id">
        <div class="message-header">
          <!-- Avatar do remetente com √≠cone -->
          <span class="sender-avatar">
            <i *ngIf="message.senderType === 'responsavel'" class="fas fa-user-friends"></i>
            <i *ngIf="message.senderType === 'professor'" class="fas fa-chalkboard-teacher"></i>
            <i *ngIf="message.senderType !== 'responsavel' && message.senderType !== 'professor'" class="fas fa-user"></i>
          </span>
          <span class="sender-name">{{ message.senderName }}</span>
          <span class="message-time"><i class="far fa-clock"></i> {{ formatTime(message.timestamp) }}</span>
        </div>
        <div class="message-content">{{ message.content }}</div>
      </div>
    </div>

    <!-- Input de Mensagem -->
    <div class="message-input-container" *ngIf="selectedChannel">
      <div class="input-wrapper">
        <input 
          type="text" 
          class="message-input"
          [(ngModel)]="newMessage"
          (keyup.enter)="sendMessage()"
          placeholder="Digite sua mensagem..."
          maxlength="500"
        >
        <button 
          class="send-btn" 
          (click)="sendMessage()"
          [disabled]="!newMessage.trim()"
        >
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>

  </div>
</div>
