<app-navbar2></app-navbar2>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="chat-container">
  <!-- Modal para Nome do Usuário -->
  <div class="modal-overlay" *ngIf="showNameModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3><i class="fas fa-user-plus"></i> Digite seu nome</h3>
        <button class="close-btn" (click)="closeModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <p>Digite seu nome como <strong>{{ getUserTypeLabel(selectedUserType) }}</strong>:</p>
        <input 
          type="text" 
          class="name-input" 
          [(ngModel)]="tempUserName"
          (keyup.enter)="confirmUserName()"
          placeholder="Seu nome..."
          maxlength="50"
          #nameInput>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn" (click)="closeModal()">
          <i class="fas fa-times"></i> Cancelar
        </button>
        <button class="confirm-btn" (click)="confirmUserName()" [disabled]="!tempUserName.trim()">
          <i class="fas fa-check"></i> Confirmar
        </button>
      </div>
    </div>
  </div>

  <!-- Seleção de Usuário -->
  <div class="user-selection" *ngIf="!currentUser">
    <div class="user-card">
      <h2><i class="fas fa-handshake"></i> Bem-vindo ao Chat!</h2>
      <p><i class="fas fa-message"></i> Converse com professores e tire dúvidas diretamente pelo Sistema.</p>
             
      <div class="user-buttons">
        <button class="user-btn aluno" (click)="openNameModal('aluno')">
          <i class="fas fa-user-astronaut"></i> Aluno
        </button>
      </div>
             
      <div class="user-helper">
        <p>Aqui você poderá:</p>
        <ul>
          <li><i class="fas fa-envelope-open-text"></i> Receber mensagens de professores</li>
          <li><i class="fas fa-users"></i> Participar de discussões da turma</li>
          <li><i class="fas fa-bell"></i> Acompanhar notificações importantes</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Interface do Chat -->
  <div class="chat-interface" *ngIf="currentUser">
    <!-- Header do Chat -->
    <div class="chat-header">
      <div class="user-info">
        <span class="user-avatar"><i class="fas fa-user-astronaut"></i></span>
        <div>
          <strong>{{ currentUser.name }}</strong>
          <small>({{ getUserTypeLabel(currentUser.type) }})</small>
        </div>
      </div>
      <div class="channel-info">
        <select class="channel-select" [(ngModel)]="selectedChannel" (change)="onChannelChange()">
          <option value="">Selecionar conversa...</option>
          <option *ngFor="let channel of getAvailableChannels()" [value]="channel.id">
            {{ channel.name }}
          </option>
        </select>
      </div>
      <button class="logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
    </div>

    <!-- Área de Mensagens -->
    <div class="messages-container" #messagesContainer>
      <div class="message-info" *ngIf="!selectedChannel">
        <p>Selecione uma conversa para começar</p>
        <i class="fas fa-comment-dots empty-chat-icon"></i>
      </div>
             
      <div class="message"
           *ngFor="let message of messages"
           [class.own-message]="message.senderId === currentUser.id"
           [class.other-message]="message.senderId !== currentUser.id">
        <div class="message-header">
          <span class="sender-avatar">
            <i class="fas" [ngClass]="message.senderId === currentUser.id ? 'fa-user-astronaut' : 'fa-user'"></i>
          </span>
          <span class="sender-name">{{ message.senderName }}</span>
          <span class="message-time">{{ formatTime(message.timestamp) }}</span>
        </div>
        <div class="message-content">{{ message.content }}</div>
      </div>
    </div>

    <!-- Input de Mensagem -->
    <div class="message-input-container" *ngIf="selectedChannel">
      <div class="input-wrapper">
        <input 
          type="text"
          class="message-input"
          [(ngModel)]="newMessage"
          (keyup.enter)="sendMessage()"
          placeholder="Digite sua mensagem..."
          maxlength="500">
        <button class="send-btn" (click)="sendMessage()" [disabled]="!newMessage.trim()">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>
</div>