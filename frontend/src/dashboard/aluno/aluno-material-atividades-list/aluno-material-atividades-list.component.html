<app-navbar></app-navbar>
<div class="container-atividades">
 
  <!-- Loading -->
  <div *ngIf="loading" class="alert-custom alert-loading">
    <div class="spinner"></div>
    Carregando atividades...
  </div>

  <!-- Sem atividades -->
  <div *ngIf="!loading && atividades.length === 0" class="alert-custom alert-warning">
    üìã Nenhuma atividade vinculada a este material.
  </div>

  <!-- Grid de atividades -->
  <div *ngIf="!loading && atividades.length > 0" class="atividades-grid">
    <div *ngFor="let atividade of atividades" class="atividade-card">
      
      <div class="card-header">
        <h5 class="card-titulo">{{ atividade.titulo }}</h5>
        <p class="card-descricao">{{ atividade.descricao }}</p>
      </div>
      
      <div class="card-info">
        <div class="info-item">
          <div class="info-label">Mat√©ria</div>
          <div class="info-value">{{ atividade.materia }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Tipo</div>
          <div class="info-value">{{ atividade.tipo }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Pontua√ß√£o</div>
          <div class="info-value">{{ atividade.pontuacao }}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Vencimento</div>
          <div class="info-value">{{ atividade.dataVencimento | date:'dd/MM/yyyy' }}</div>
        </div>
      </div>

      <div class="conteudo-box">
        {{ atividade.conteudo }}
      </div>

      <!-- Tradu√ß√£o -->
      <div class="traducao-buttons">
        <button class="btn-traducao btn-ingles"
                (click)="traduzirAtividade(atividade, 'en')"
                [disabled]="atividade.traduzindo">
          <span *ngIf="atividade.traduzindo" class="spinner"></span>
          {{ atividade.traduzindo ? 'Traduzindo...' : 'EN' }}
        </button>
        <button class="btn-traducao btn-espanhol"
                (click)="traduzirAtividade(atividade, 'es')"
                [disabled]="atividade.traduzindo">
          <span *ngIf="atividade.traduzindo" class="spinner"></span>
          {{ atividade.traduzindo ? 'Traduzindo...' : 'ES' }}
        </button>
      </div>

      <div *ngIf="atividade.traducaoIngles" class="traducao-resultado">
        <strong>EN:</strong> {{ atividade.traducaoIngles }}
      </div>
      <div *ngIf="atividade.traducaoEspanhol" class="traducao-resultado">
        <strong>ES:</strong> {{ atividade.traducaoEspanhol }}
      </div>

      <!-- Resposta OU Status -->
      <ng-container *ngIf="atividade.status !== 'ENVIADA' && atividade.status !== 'CORRIGIDA'; else statusTpl">
        <div class="resposta-section">
          <label for="resposta-{{ atividade.id }}" style="font-weight: 600; margin-bottom: 8px; display: block;">
            Sua resposta:
          </label>
          <textarea id="resposta-{{ atividade.id }}"
                    [(ngModel)]="atividade.resposta"
                    class="resposta-textarea"
                    placeholder="Digite sua resposta..."></textarea>
          <button class="btn-enviar" (click)="enviarResposta(atividade)">
            Enviar Resposta
          </button>
        </div>
      </ng-container>

      <ng-template #statusTpl>
        <div class="status-enviado">
          <div>‚úÖ <strong>Resposta enviada</strong></div>
          <div *ngIf="atividade.status === 'CORRIGIDA'" class="feedback-section">
            <div><strong>Nota:</strong> {{ atividade.nota }}</div>
            <div><strong>Feedback:</strong> {{ atividade.feedback || '‚Äî' }}</div>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <button type="button" class="btn-voltar" (click)="voltar()">
    ‚Üê Voltar
  </button>
</div>
